<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HOME</title>
</head>

<body>
  <label for="phrase-search">Buscador de frases famosas del cine</label>
  <input type="text" name="phrase-search" id="phrase-search">
  <div id="container"></div>

  <script>
    const phraseSearch = document.getElementById("phrase-search");
    const divContainer = document.getElementById("container");
    const uList = document.createElement("ul");
    divContainer.append(uList);
    const baseUrl = "/phrases?phrases=";



    phraseSearch.addEventListener("keyup", () => {
      uList.innerHTML = "";
      const input = phraseSearch.value;
      if (input.length>0) getResults(input);

    });

    function getResults(input) {
      const xhr = new XMLHttpRequest();

      xhr.onload = function () {

        if (this.status === 200) {
          const results = JSON.parse(this.responseText);
          console.log(results);
          if (results.length > 0) {
            results.forEach(element => {
              const split = element.split(input);
              const li = document.createElement("li");
              const strong = document.createElement("STRONG");
              const bInput = document.createTextNode(input);
              strong.appendChild(bInput);
              for (let i = 0; i < split.length-1; i++) {
                const part = split[i];
                const partial = document.createTextNode(part);
                li.appendChild(partial);
                li.appendChild(strong);                
              }
              const last = document.createTextNode(split[split.length-1]);
              li.appendChild(last);

              uList.appendChild(li);
            });
          }
        }

      }
      xhr.open("GET", baseUrl + input);
      xhr.send();

    }
  </script>
</body>

</html>